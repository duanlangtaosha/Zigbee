C51 COMPILER V9.55   BSP_UART                                                              08/05/2016 00:49:06 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE BSP_UART
OBJECT MODULE PLACED IN .\Objects\bsp_uart.obj
COMPILER INVOKED BY: D:\MDK520\C51\BIN\C51.EXE App\bsp_uart.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\bsp_uart.lst) OBJECT(.\Objects\bsp_uart.obj)

line level    source

   1          /*********************************************************************************************************
   2          *       Project Name    :       串口驱动模块
   3          *       File    Name    :       bsp_uart.c
   4          *       Function                :       支持printf和scanf，其中printf是亲测了的
   5          *       Chip                    :       STC89C52RC
   6          *       OSC                             :       11.0592M
   7          *       Made    By              :       断浪淘沙
   8          *       Vision                  :       1.0
   9          *       Copyright (C), 2016-2017, 断浪淘沙 QQ:891650837
  10          *
  11          *********************************************************************************************************/
  12          
  13          #include "./head/bsp.h"
  14          
  15          void Uart_isr() interrupt 4      //中断接收程序
  16          {
  17   1              if(RI)                     //判断是否接收完，接收完成后，由硬件置RI位
  18   1              {
  19   2                      //Txd_data=SBUF;               //读入缓冲区
  20   2                      //=0;                      /RI/清标志
  21   2                      //Recdat=1;             //有数据，建立标志
  22   2              }
  23   1      }
  24          
  25          /*
  26          *********************************************************************************************************
  27          *       函 数 名: bsp_SendUart
  28          *       功能说明: 通过串口发送一个字节，等待发送完毕后才返回。
  29          *       形    参：_data ： 待发送的数据
  30          *       返 回 值: 无
  31          *********************************************************************************************************
  32          */
  33          void UART_SendByte(uint8_t _data)
  34          {
  35   1              SBUF = _data;   /* 发送数据送缓冲 */
  36   1              while(!TI);             /* 等待发送完成 */
  37   1              TI = 0;
  38   1      }
  39          
  40          /*
  41          *********************************************************************************************************
  42          *       函 数 名: UART_GetByte
  43          *       功能说明: 等待串口接收一个字节
  44          *       形    参：_data ： 待发送的数据
  45          *       返 回 值: 无
  46          *********************************************************************************************************
  47          */
  48          uint8_t UART_GetByte(void)
  49          {
  50   1              uint8_t c;
  51   1      
  52   1              while (RI == 0);
  53   1              c = SBUF;
  54   1              RI = 0; 
C51 COMPILER V9.55   BSP_UART                                                              08/05/2016 00:49:06 PAGE 2   

  55   1      
  56   1              return c;
  57   1      }
  58          
  59          /*
  60          *********************************************************************************************************
  61          *       函 数 名: UART_SendBuf
  62          *       功能说明: 通过串口发送一个字节，等待发送完毕后才返回。
  63          *       形    参：_pBuf : 待发送的数据缓冲区
  64          *                         _len : 数据长度
  65          *       返 回 值: 无
  66          *********************************************************************************************************
  67          */
  68          void UART_SendBuf(uint8_t *_pBuf, uint8_t _len)
  69          {
  70   1              while(_len--)
  71   1              {
  72   2                      UART_SendByte(*_pBuf++);
  73   2              }
  74   1      }
  75          
  76          /*
  77          *********************************************************************************************************
  78          *       函 数 名: bsp_InitUart
  79          *       功能说明: 初始化CPU的U串口硬件设备。未启用中断。
  80          *       形    参：无
  81          *       返 回 值: 无
  82          *********************************************************************************************************
  83          */
  84          void bsp_InitUart(void)
  85          {
  86   1              SCON = 0x50;    /* 010 1 0000B，工作方式1, 8位UART，波特率可变，允许接收 */
  87   1              TMOD = 0x20;    /* T1工作于方式2 */
  88   1              TCON = 0x40;    /* 定时器1开始计数 */
  89   1              TH1 = 250;              /* T1计数初值 */
  90   1              TL1 = 250;
  91   1              PCON = 0x80;    /* SMOD置1,双倍速率 */
  92   1              RI = 0;
  93   1              TI = 0;
  94   1      }
  95          
  96          /***************************** 断浪淘沙(END OF FILE) *********************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     76    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
